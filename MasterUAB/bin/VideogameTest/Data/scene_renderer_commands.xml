<?xml version="1.0" encoding="ISO-8859-1"?>
<scene_renderer_commands>
	<set_depth_stencil_state enable_z_test="true" write_z_buffer="true"/>
	
	<set_pool_renderable_objects_technique pool="generate_shadow_map"/>
	<generate_shadow_maps/>
	
	<set_render_target name="deferred_multiple_render_target">
		<dynamic_texture name="DiffuseMapTexture" texture_width_as_frame_buffer="true" create_depth_stencil_buffer="false"/>
		<dynamic_texture name="LightMapTexture" texture_width_as_frame_buffer="true"/>
		<dynamic_texture name="NormalMapTexture" texture_width_as_frame_buffer="true"/>
		<dynamic_texture name="DepthMapTexture" texture_width_as_frame_buffer="true" format_type = "R32_FLOAT"/>
	</set_render_target>

	
	<clear render_target="true" depth_stencil="true"/>
	
	<set_pool_renderable_objects_technique pool="generate_g_buffer"/>
	
	<set_matrices/>
	
	<render_layer layer="solid" active="true"/>
	
	<unset_render_target/>

	
	<clear render_target="true" depth_stencil="false"/>
	<set_depth_stencil_state enable_z_test="false" write_z_buffer="false"/>
	
	<!-- Ambient*Albedo(Deferred) -->
	<render_draw_quad> 
		<texture stage_id="0" file="LightMapTexture"/>
	</render_draw_quad> 
	
	<!-- Deferred Shading -->
	<set_pool_renderable_objects_technique pool="deferred_shading" active="true"/>
	<render_deferred_shading active="true">
		<texture stage_id="0" file="DiffuseMapTexture"/>
		<texture stage_id="1" file="NormalMapTexture"/>
		<texture stage_id="2" file="DepthMapTexture"/>
		<texture stage_id="3" file="LightMapTexture"/>
	</render_deferred_shading> 
	
	<!-- Fog -->
	<capture_frame_buffer>
		<capture_texture name="DeferredCapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	<set_pool_renderable_objects_technique pool="deferred_fog_shading_pool_renderable_object_technique"/>
	<render_draw_quad material="DeferredFogMaterial">
		<texture stage_id="0" file="DeferredCapturedTexture"/>
		<texture stage_id="1" file="DepthMapTexture"/>
	</render_draw_quad>
	
	<!-- ZBlur -->
	<capture_frame_buffer>
		<capture_texture name="ZBlurCapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	<set_pool_renderable_objects_technique pool="gaussian_filter_pool_renderable_object_technique"/>
	<apply_filters>
		<texture stage_id="0" file="ZBlurCapturedTexture"/>
		<dynamic_texture name="StartZBlur" width="512" height="512" material="GUIMaterial"/>
		<dynamic_texture name="ZBlur3" width="512" height="512" material="GaussianFilterMaterial"/>
		<dynamic_texture name="ZBlur2" width="512" height="512" material="GaussianFilterMaterial"/>
		<dynamic_texture name="ZBlur1" width="512" height="512" material="GaussianFilterMaterial"/>
		<dynamic_texture name="ZBlur" width="512" height="512" material="GaussianFilterMaterial"/>
	</apply_filters>
	<set_pool_renderable_objects_technique pool="zblur_pool_renderable_object_technique"/>
	<render_draw_quad material="ZBlurMaterial">
		<texture stage_id="0" file="ZBlurCapturedTexture"/>
		<texture stage_id="1" file="ZBlur"/>
		<texture stage_id="2" file="DepthMapTexture"/>
	</render_draw_quad>
	
	
	<!-- HDAO -->
	<capture_frame_buffer>
		<capture_texture name="HDAOCapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	<set_pool_renderable_objects_technique pool="HDAO_pool_renderable_object_technique"/>
	
	<render_draw_quad material="HDAOMaterial">
		<texture stage_id="0" file="HDAOCapturedTexture"/>
		<texture stage_id="1" file="NormalMapTexture"/>
		<texture stage_id="2" file="DepthMapTexture"/>
	</render_draw_quad> 
	
	<!-- Bloom -->
	<capture_frame_buffer>
		<capture_texture name="ThresholdCapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	<set_pool_renderable_objects_technique pool="threshold_filter_pool_renderable_object_technique"/>
	<render_draw_quad material="ThresholdMaterial">
		<texture stage_id="0" file="ThresholdCapturedTexture"/>
	</render_draw_quad>
	<capture_frame_buffer>
		<capture_texture name="GussianCapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	<set_pool_renderable_objects_technique pool="gaussian_filter_pool_renderable_object_technique"/>
	<apply_filters>
		<texture stage_id="0" file="GussianCapturedTexture"/>
		<dynamic_texture name="StartGaussian" width="512" height="512" material="GUIMaterial"/>
		<dynamic_texture name="Gaussian3" width="512" height="512" material="GaussianFilterMaterial"/>
		<dynamic_texture name="Gaussian2" width="512" height="512" material="GaussianFilterMaterial"/>
		<dynamic_texture name="Gaussian1" width="512" height="512" material="GaussianFilterMaterial"/>
		<dynamic_texture name="Gaussian" width="512" height="512" material="GaussianFilterMaterial"/>
	</apply_filters>
	<set_pool_renderable_objects_technique pool="bloom_pool_renderable_object_technique"/>
	<render_draw_quad material="BloomMaterial">
		<texture stage_id="0" file="ThresholdCapturedTexture"/>
		<texture stage_id="1" file="Gaussian"/>
	</render_draw_quad> 
	
	
	<!-- ColorGrading -->
	<!-- <set_pool_renderable_objects_technique pool="color_grading_pool_renderable_object_technique"/>
	<capture_frame_buffer>
		<capture_texture name="ColorGradingCapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	<render_draw_quad material="ColorGradingMaterial">
		<texture stage_id="0" file="ColorGradingCapturedTexture"/>
	</render_draw_quad> -->
	
	
	<!-- LightScattering -->
	<!-- <set_render_target>
		<dynamic_texture name="LightScatteringTextureSkybox" texture_width_as_frame_buffer="true" create_depth_stencil_buffer="false"/>
	</set_render_target>
	<clear render_target="true" depth_stencil="false"/>
	<set_pool_renderable_objects_technique pool="light_scattering_pool"/>
	<set_matrices/>
	<render_layer layer="skybox" active="true"/>
	<unset_render_target/> -->
	
	<!-- <apply_filters>
		<texture stage_id="0" file="LightScatteringTextureSkybox"/>
		<dynamic_texture name="StartLightScatteringTexture" width="512" height="512" material="GUIMaterial"/>
		<dynamic_texture name="LightScatteringTextureSkyboxBlurred2" width="512" height="512" material="GaussianFilterMaterial"/>
		<dynamic_texture name="LightScatteringTextureSkyboxBlurred1" width="512" height="512" material="GaussianFilterMaterial"/>
		<dynamic_texture name="LightScatteringTextureSkyboxBlurred" width="512" height="512" material="GaussianFilterMaterial"/>
	</apply_filters> -->
	
	<!-- <enable_additive_alpha_blend/>
	<set_pool_renderable_objects_technique pool="light_scattering_pool"/>
	<render_draw_quad material="LightScatteringMaterial">
		<texture stage_id="0" file="LightScatteringTextureSkyboxBlurred"/>
	</render_draw_quad> -->
	
	
	<!-- SSR -->
	<!-- <set_pool_renderable_objects_technique pool="ssr_pool"/>
	<capture_frame_buffer>
		<capture_texture name="SSRCapturedTexture" texture_width_as_frame_buffer="true"/>
	</capture_frame_buffer>
	<render_draw_quad material="SSRMaterial">
		<texture stage_id="0" file="DiffuseMapTexture"/>
		<texture stage_id="1" file="DepthMapTexture"/>
		<texture stage_id="2" file="NormalMapTexture"/>
	</render_draw_quad> -->
	
	<!-- Noise and Vignetting -->
	<!-- <set_depth_stencil_state enable_z_test="false" write_z_buffer="false" enable_stencil="false"/>
	<enable_alpha_blend/>
	<set_pool_renderable_objects_technique pool="noise_and_vignetting_pool"/>
	<render_draw_quad material="NoiseAndVignettingMaterial">
		<texture stage_id="0" file="Data/GUI/textures/noise.dds" load_file="true"/>
		<texture stage_id="1" file="Data/GUI/textures/vignetting.dds" load_file="true"/>
	</render_draw_quad>
	
	<set_depth_stencil_state enable_z_test="true" write_z_buffer="true"/>
	<set_pool_renderable_objects_technique pool="forward_shading" active="true"/>
	 -->
	<!-- <render_layer layer="solid" active="true"/> -->
	<!-- <render_debug_layer layer="solid" active="true"/> -->
	
	<!-- <set_matrices/> -->
	<set_pool_renderable_objects_technique pool="forward_shading"/>
	<enable_alpha_blend/>
	<set_depth_stencil_state enable_z_test="true" write_z_buffer="false"/>
	<render_layer layer="particles" active="true"/>
	<disable_alpha_blend/>
	
	<!-- <clear render_target="false" depth_stencil="false"/> -->
	<set_light_constants/>
	
	<!-- <set_depth_stencil_state enable_z_test="true" write_z_buffer="false"/> -->
	<!-- <render_layer layer="skybox" active="true"/> -->
	
	<set_depth_stencil_state enable_z_test="false" write_z_buffer="false"/>
	
	<render_debug_gui/>
	<enable_alpha_blend/>
	<render_gui/>
	<disable_alpha_blend/>
	<!-- <render_debug_grid/> -->
	<!--
	-->
	<!-- <render_debug_layer layer="solid" active="true"/> -->
	<!-- <render_debug_lights/> -->
	
	<present/>
</scene_renderer_commands>

